#version 130

uniform sampler2DArray TileTextures;

uniform vec4 LightColor;
uniform vec2 LightPosition;
uniform float LightRadius;
uniform bool LightEnable;

uniform float AmbientIntensity;
uniform vec4 AmbientColor;

in vec4 gl_FragCoord;

in vec2 psTexcoord;
flat in uint psTileIndex;
in vec2 psPosition;

out vec4 outColor;


void main()
{
	vec4 texColor = texture(TileTextures,vec3(psTexcoord,psTileIndex));
	
	vec2 distVec =  LightPosition - psPosition.xy;
	float dist = dot(distVec,distVec);
	
	dist = 1 - clamp(dist /LightRadius,0,1); 
	
	vec4 IAmbient = texColor * AmbientColor * AmbientIntensity;
	IAmbient = vec4(IAmbient.rgb,texColor.a);
	
	outColor = IAmbient;
	
	if(LightEnable)
	{
	    vec4 ILight = texColor * vec4(vec3(dist) * LightColor.rgb,1);
    	
    	outColor += ILight;
	}
	
	
	outColor = clamp(outColor,0,1);
}
